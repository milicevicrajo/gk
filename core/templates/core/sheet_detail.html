{% extends "base.html" %}

{% block title %}GK detalj · {{ sheet.project.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">Građevinska knjiga #{{ sheet.pk }}</h1>
        <p class="text-body-secondary mb-0">{{ sheet.project.name }} · {{ sheet.date|date:"d.m.Y" }}</p>
    </div>
    <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{% url 'core:sheet-list' %}">Nazad</a>
        {% if can_edit %}
            <a class="btn btn-primary" href="{% url 'core:sheet-update' sheet.pk %}">Izmeni</a>
        {% endif %}
        {% if can_submit %}
            <form method="post" action="{% url 'core:sheet-submit' sheet.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-success">Pošalji na reviziju</button>
            </form>
        {% endif %}
    </div>
</div>
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h2 class="h6 text-uppercase text-body-secondary">Detalji</h2>
                <dl class="row mb-0">
                    <dt class="col-sm-4">Status</dt>
                    <dd class="col-sm-8"><span class="badge text-bg-secondary text-uppercase">{{ sheet.get_status_display }}</span></dd>
                    <dt class="col-sm-4">Datum</dt>
                    <dd class="col-sm-8">{{ sheet.date|date:"Y-m-d" }}</dd>
                    <dt class="col-sm-4">Napomena</dt>
                    <dd class="col-sm-8">{{ sheet.note|default:"—" }}</dd>
                    <dt class="col-sm-4">Komentar nadzora</dt>
                    <dd class="col-sm-8">{{ sheet.review_note|default:"—" }}</dd>
                </dl>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <h2 class="h6 text-uppercase text-body-secondary">Informacije</h2>
                <p class="mb-0">Ukupno stavki: {{ entries|length }}</p>
                {% if sheet.status == sheet.Status.SUBMITTED %}
                    <p class="mb-0 text-body-secondary">Knjiga čeka reviziju.</p>
                {% elif sheet.status == sheet.Status.APPROVED %}
                    <p class="mb-0 text-success">Knjiga je odobrena.</p>
                {% elif sheet.status == sheet.Status.REJECTED %}
                    <p class="mb-0 text-danger">Knjiga je odbijena.</p>
                {% endif %}
                {% if can_review %}
                    <p class="mt-3 mb-0 text-body-secondary">Pregled nadzornih tokena je u pripremi.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<h2 class="h5">Stavke</h2>
<div class="table-responsive">
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th scope="col">Šifra</th>
                <th scope="col">Opis</th>
                <th scope="col">Jedinica</th>
                <th scope="col">Količina</th>
                <th scope="col">Komentar</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in entries %}
                <tr>
                    <td>{{ entry.boq_item.code }}</td>
                    <td>{{ entry.boq_item.description }}</td>
                    <td>{{ entry.boq_item.unit_of_measure }}</td>
                    <td>{{ entry.quantity }}</td>
                    <td>{{ entry.comment|default:"—" }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-body-secondary">Nema unetih stavki.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
